var OHUB=OHUB||{},CMG=CMG||{};CMG.widget=CMG.widget||{},CMG.widget.main=function(){return{common:new CMG.widget.common,config:{lmt:"1411885082",base_url:null,widget_url:null,insert_target:null,widget_id:null,dom_id:null,type:null,theme:null,temp:null,is_theme_custom:!1,is_overriden:!1,old_widget_id:null,old_type:null,old_layout:null,old_width:null,old_height:null,old_theme_id:null,width:null,layout:null,height:null,ref_domain:"",url_params:"",display_width:920},ad:{},id:{},q:null,options:null,data:{},templates:{},init:function(a){OHUB.setup_cors();var b=this;b.config.widget_id=a.widget_id,b.config.dom_id=a.dom_id,b.config.type=a.type,b.config.layout=a.layout,b.config.width=a.width,b.config.height=a.height,b.config.theme=a.theme,b.config.temp=a.temp,b.config.is_theme_custom=a.is_theme_custom,b.config.is_overriden=a.is_overriden,b.config.old_widget_id=a.old_widget_id,b.config.old_type=a.old_type,b.config.old_layout=a.old_layout,b.config.old_width=a.old_width,b.config.old_height=a.old_height,b.config.old_theme_id=a.old_theme_id,b.config.base_url=b.common.base_url(!0,a.type),b.config.widget_url=b.common.widget_url(b.config.widget_id),b.config.insert_target=a.insert_target,b.config.ref_domain=a.ref_domain,b.common.stats.ref=b.config.ref_domain,b.common.config.is_dev=a.is_dev,("dashboard"===b.config.type||"dashboard-youtube"===b.config.type)&&(b.ad.db_ad_image=a.db_ad_image,b.ad.db_ad_clickthru=a.db_ad_clickthru,b.ad.db_ad_impression=a.db_ad_impression,b.ad.db_ad_background=a.db_ad_background),b.debug("init(widget_id="+a.widget_id+", dom_id="+a.dom_id+", type="+a.type+", insert_target="+a.insert_target+", theme="+a.theme+", layout="+a.layout+", width="+a.width+", height="+a.height+", temp="+a.temp+")");var c=navigator.userAgent.match(/MSIE (\d+)/);c&&parseInt(c[1],10)<=9&&"NaN"!=parseInt(document.location.hash,10)&&""!==document.location.hash&&(document.location.hash="_"),b.shell.init(b),b.display.init(b),b.share.init(b),b.id={shell:"HPW-shell-"+b.config.widget_id+"-"+b.config.type,display:"HPW-display-"+b.config.widget_id+"-"+b.config.type,error:"HPW-error-"+b.config.widget_id+"-"+b.config.type,share:"HPW-share-"+b.config.widget_id+"-"+b.config.type,close:"HPW-close_modal-"+b.config.type,loading:"HPW-loading-"+b.config.type,dimmer:"OHUB_DIMMER"},b.listen(),$hpw_.when(b.boot()).then(function(){b.setup()})},boot:function(){this.debug("boot(id="+this.config.widget_id+",type="+this.config.type+")");var a=this,b=$hpw_.Deferred();return $hpw_.when(a.common.fetch_config(a.config.temp,a.config.widget_id,a.config.type)).then(function(c){c===!1?(a.render_error(),b.resolve()):(a.options=c,a.check_config(function(){var c=""!==a.config.layout?a.config.layout:a.options.layout;a.options.layout="custom"!=c?{width:a.common.layouts[c].width,height:a.common.layouts[c].height}:{width:""!==a.config.width?a.config.width:a.options.width,height:""!==a.config.height?a.config.height:a.options.height},""!==a.config.theme&&(a.options.theme.url="/core/css/themes/widget_"+a.config.theme+".css"),a.options.height=a.options.layout.height,a.options.width=a.options.layout.width,b.resolve()}))}),b.promise()},check_config:function(a){var b=this;""!==b.config.width&&(b.config.width<300?b.config.width=300:b.config.width>1200&&(b.config.width=1200)),""!=b.config.height&&(b.config.height<250?b.config.height=250:b.config.height>1200&&(b.config.height=1200));var c=["full","half","column","custom"],d=$hpw_.inArray(b.config.layout,c);if(-1==d&&(b.config.layout=""),""!==b.config.theme){var e=["gray","light","dark","camo","fall","lake","metal","offroad","salt","spring","tactical","winter","wood"],f=$hpw_.inArray(b.config.theme,e);-1==f&&(b.config.theme="")}return"function"==typeof a?a():void 0},setup:function(a){this.debug("setup()"),OHUB.add_dimmer();var b=this;$hpw_("#"+this.id.dimmer).css("cursor","pointer"),$hpw_("body").on("click","#"+this.id.dimmer,function(){$hpw_("#"+b.id.close).trigger("click")}),this.render(function(){return a()})},render:function(){this.debug("render()");var a=this,b="standard";this.render_overrides(),this.shell.render(function(){a.shell.show(),(null==a.config.temp||""==a.config.temp)&&(("youtube"===a.config.type||"dashboard-youtube"===a.config.type)&&(b="youtube"),a.common.stat({t:"widget",w:a.config.widget_id,wt:b,x:a.common.stats.action_ids.widget_impression,c:a.common.stats.component_ids.primary_deployment},a.config.type))})},render_close:function(){this.debug("render_close()");var b=this,c=$hpw_("<img />",{src:this.common.base_url(!1)+"/core/images/button-close.png",width:55,height:55,alt:"Close",id:this.id.close}),d={position:"fixed",display:"none",left:"50%",marginLeft:"405px",cursor:"pointer",top:"6%",width:"55px",height:"55px",zIndex:OHUB.get_nhz()};$hpw_("body").prepend(c);var e=$hpw_("#"+this.id.close);e.css(d),e.data("self_display",b.id.display),e.data("self_share",b.id.share),e.data("self_close",b.id.close),e.data("self_loading",b.id.loading),e.one("click",function(){var b=["#"+$hpw_(this).data("self_display"),"#"+$hpw_(this).data("self_share"),"#"+$hpw_(this).data("self_close"),"#"+$hpw_(this).data("self_loading")];$hpw_(b.join(", ")).fadeOut("fast",function(){$hpw_(this).remove()}),OHUB.undim("slow")}),e.fadeIn("slow")},render_error:function(){this.debug("render_error()");var a=$hpw_("<div />",{id:this.id.error,style:"font-family: sans-serif; font-size: 75%; color: red; padding: 4px; border: double red;"});this.debug(this.config),$hpw_(this.config.insert_target).before(a),$hpw_("#"+this.id.error).prepend('<h3 style="font-weight: normal; margin: 0;"><a style="font-weight: bold; color: red;" href="http://connect.outdoorhub.com">Outdoor Hub Connect</a>: Widget [id: <strong>'+this.config.widget_id+"</strong>, type: <strong>"+this.config.type+"</strong>] "+"not found!"+"</h3>"+'<p style="margin: 4px 0 0 0;">'+"Please verify that <strong>id</strong> and <strong>type</strong> are correct in the script src "+"<strong>id</strong>, and <strong>t</strong> query string parameters and the <strong>data-widget_id</strong> "+"script attribute matches."+"</p>")},render_overrides:function(){this.debug("render_overrides()");var a=$hpw_("<style />",{type:"text/css",href:this.config.base_url+"/css/widget_override.css",rel:"stylesheet"});$hpw_("head").append(a)},listen:function(){this.debug("listen()");var a=this;$hpw_.receiveMessage(function(b){OHUB.in_array(b.data,CMG.widgets.msg_queue)||(CMG.widgets.msg_queue.push(b.data),a.handle_message(b))},"http://"+a.common.config.host)},handle_message:function(a){for(var b=this,c=decodeURIComponent(a.data).split("&"),d={},e=0;e<c.length;e++){var f=c[e].split("=");d[f[0]]=f[1]}switch(b.debug("=== IFRAME LISTENER: "+d.action.toUpperCase()+" ===","info"),b.debug(d),d.action){case"load":"youtube"===d.widget_type?CMG.widgets[d.dom_id].display.load_youtube(d):CMG.widgets[d.dom_id].display.load_standard(d);break;case"share":CMG.widgets[d.dom_id].share.show(d);break;case"realtime":b.debug("=== IFRAME LISTENER: REALTIME","info");break;case"close":CMG.widgets[d.dom_id].render_close(d.widget_type);break;case"modal_close":$hpw_("#"+CMG.widgets[d.dom_id].id.close).trigger("click");break;case"dashboard_open":$hpw_("#HPW-shell-"+d.widget_id+"-dashboard").animate({height:"140px"},800);break;case"dashboard_close":$hpw_("#HPW-shell-"+d.widget_id+"-dashboard").animate({height:"0px"},800);break;case"dashboard_yt_open":$hpw_("#HPW-shell-"+d.widget_id+"-dashboard-youtube").animate({height:"140px"},800);break;case"dashboard_yt_close":$hpw_("#HPW-shell-"+d.widget_id+"-dashboard-youtube").animate({height:"0px"},800)}setTimeout(function(){CMG.widgets.msg_queue.pop()},50+b.config.dom_id)},shell:{parent:null,init:function(a){this.parent=a,this.parent.debug("shell.init(parent="+typeof a+")")},render:function(a){this.parent.debug("shell.render(cb="+typeof a+")");var c=$hpw_("#"+this.parent.id.shell);if(0===c.length){var d={widget_id:this.parent.config.widget_id,dom_id:this.parent.config.dom_id,type:this.parent.config.type,layout:this.parent.config.layout,width:this.parent.config.width,height:this.parent.config.height,theme:this.parent.config.theme,temp:this.parent.config.temp,is_theme_custom:this.parent.config.is_theme_custom,is_overriden:this.parent.config.is_overriden,old_widget_id:this.parent.old_widget_id,old_type:this.parent.old_type,old_layout:this.parent.old_layout,old_width:this.parent.old_width,old_height:this.parent.old_height,old_theme_id:this.parent.old_theme_id,is_dev:this.parent.common.config.is_dev,ref:this.parent.config.ref_domain};("dashboard"===this.parent.config.type||"dashboard-youtube"===this.parent.config.type)&&(d.db_ad_image=this.parent.ad.db_ad_image,d.db_ad_clickthru=this.parent.ad.db_ad_clickthru,d.db_ad_impression=this.parent.ad.db_ad_impression,d.db_ad_background=this.parent.ad.db_ad_background);var e=this.parent.config.base_url+"/shell.html?"+$hpw_.param(d)+"#"+encodeURIComponent(document.location.href),f=$hpw_("<iframe />",{id:this.parent.id.shell,src:e,"class":"auto-height",scrolling:"no",frameborder:"no"});if("dashboard"===d.type||"dashboard-youtube"===d.type){var g=OHUB.get_nhz(),h={display:"none",width:"100%",height:"1px",position:"fixed",bottom:"0",left:"0","z-index":g};$hpw_("#OHUB_DIMMER").css("z-index",g+1),$hpw_("body").prepend(f)}else{var h={display:"none",width:("undefined"!=typeof this.parent.options.width?this.parent.options.width:728)+"px",height:("undefined"!=typeof this.parent.options.height?this.parent.options.height:525)+"px"};$hpw_(this.parent.config.insert_target).before(f)}var c=$hpw_("#"+this.parent.id.shell);c.css(h),c.bind("load",function(){return"function"==typeof a?a():void 0})}},show:function(a){this.parent.debug("shell.show(cb="+typeof a+")");var b=$hpw_("#"+this.parent.id.shell);return b.show(),"function"==typeof a?a():void 0}},display:{parent:null,init:function(a){this.parent=a,this.parent.debug("display.init(parent="+typeof a+")")},show:function(a){this.parent.debug("display.show(cb="+typeof a+")");var b=["#"+this.parent.id.display,"#"+this.parent.id.close,"#"+this.parent.id.loading];return $hpw_(b.join(", ")).show(),"function"==typeof a?a():void 0},hide:function(a){this.parent.debug("display.hide(cb="+typeof a+")");var b=["#"+this.parent.id.display,"#"+this.parent.id.close,"#"+this.parent.id.loading];return $hpw_(b.join(", ")).hide(),"function"==typeof a?a():void 0},render_standard:function(a,b,c){this.parent.debug("display.render_standard(type="+a+", qs="+b+", cb="+typeof c+")");var d=this.parent.common.standard.display_types,e=$hpw_("#"+this.parent.id.display),f=this;if(a="undefined"!=typeof a?a:"custom",-1==$hpw_.inArray(a,d))return this.parent.debug('display.render() - illegal type passed: "'+a+'"! aborting!',"warn"),void 0;"undefined"==typeof b&&(b={widget_id:this.parent.config.widget_id}),b.ref=this.parent.config.ref_domain,b.dom_id=this.parent.config.dom_id,b.widget_type=this.parent.config.type,b.temp=this.parent.config.temp,b.is_dev=this.parent.common.config.is_dev,b.lmt=this.parent.config.lmt;var g=this.parent.config.base_url+"/display.html?"+$hpw_.param(b)+"#"+encodeURIComponent(document.location.href);if(g=g.replace("dashboard","standard"),0===e.length){var h=$hpw_("#"+this.parent.id.dimmer),i=$hpw_("<iframe />",{id:this.parent.id.display,src:g,allowtransparency:"true","class":"auto-height",scrolling:"no",frameborder:"no",style:"visibility: hidden;",onload:"this.style.visibility = 'visible'"}),j={position:"fixed",width:this.parent.config.display_width+"px",height:"100%",top:"0px",left:"0px",right:"0px",margin:"0 auto",minHeight:"500px",borderRadius:"11px",zIndex:OHUB.get_nhz()};$hpw_("body").prepend(i);var e=$hpw_("#"+this.parent.id.display);e.css(j);var k=$hpw_("<div />",{id:this.parent.id.loading,style:"font-family: sans-serif; font-size: 18px; font-weight: bold; color: #fff;"}),l=$hpw_("<img />",{src:this.parent.common.base_url(!1)+"/core/images/loading.gif",width:128,height:15,border:0,alt:"Loading... Please wait."}),m={position:"fixed",display:"none",width:"128px",height:"15px",top:"48%",left:"50%",marginLeft:"-"+parseInt(64,10)+"px",zIndex:parseInt(h.css("z-index"),10)+1};h.before(k);var n=$hpw_("#"+this.parent.id.loading);n.css(m).text("Loading...").append(l),n.fadeIn("medium")}else e.attr("src",g);$hpw_("#OHUB_DIMMER").on("click",function(){f.hide()}),e.bind("load",function(){return"function"==typeof c?c():void 0})},load_standard:function(a,b){this.parent.debug("display.load_standard(widget_id="+a.widget_id+", topic="+a.topic+", type="+a.type+", item_id="+a.item_id+", cb="+typeof b+")");var c=this,d=this.parent.common.data_url({widget_id:a.widget_id,dom_id:a.dom_id,topic:a.topic,type:a.type,format:"items",item_id:a.item_id,is_theme_custom:a.is_theme_custom,is_overriden:a.is_overriden,old_widget_id:a.old_widget_id,old_type:a.old_type,old_layout:a.old_layout,old_width:a.old_width,old_height:a.old_height,old_theme_id:a.old_theme_id,vertical_id:a.vertical_id,ref:this.parent.ref_domain});-1==d.indexOf("undefined")&&(d+="?vertical_id="+a.vertical_id,d=d.replace("dashboard","standard"),this.parent.debug(d,"info"),$hpw_.jsonp({url:d,cache:!0,callback:"cb",callbackParameter:"cb",success:function(d){var f=d.item;OHUB.dim("fast",.75,function(){c.render_standard(c.parent.common.standard.display_type_map[a.type],{widget_id:a.widget_id,dom_id:a.dom_id,topic:a.topic,type:a.type,format:"item",item_id:a.item_id,post_url:f.url,post_guid:f.guid,post_id:f.id,post_title:f.title,temp:c.parent.config.temp,is_theme_custom:a.is_theme_custom,is_overriden:a.is_overriden,old_widget_id:a.old_widget_id,old_type:a.old_type,old_layout:a.old_layout,old_width:a.old_width,old_height:a.old_height,old_theme_id:a.old_theme_id,vertical_id:a.vertical_id},b)})}}))},render_youtube:function(a,b,c,d,e){var f=this;f.parent.debug("display.render(widget_id="+a+", channel="+b+", playlist="+c+", video="+d+")");var g=$hpw_("#"+this.parent.id.display),h={widget_id:a,dom_id:f.parent.config.dom_id,widget_type:f.parent.config.type,channel:b,playlist:c,video:d,ref:this.parent.config.ref_domain,temp:this.parent.config.temp,is_dev:this.parent.common.config.is_dev,lmt:this.parent.config.lmt},i=this.parent.config.base_url+"/display.html?"+$hpw_.param(h)+"#"+encodeURIComponent(document.location.href);if(i=i.replace("dashboard-youtube","youtube"),0===g.length){var j=$hpw_("#"+this.parent.id.dimmer),k=$hpw_("<iframe />",{id:this.parent.id.display,src:i,allowtransparency:"true","class":"auto-height",scrolling:"no",frameborder:"no",style:"visibility: hidden;",onload:"this.style.visibility = 'visible'"}),l={position:"fixed",width:this.parent.config.display_width+"px",height:"100%",top:"0px",left:"0px",right:"0px",minHeight:"400px",margin:"0 auto",borderRadius:"11px",zIndex:OHUB.get_nhz()};$hpw_("body").prepend(k);var g=$hpw_("#"+this.parent.id.display);g.css(l);var m=$hpw_("<div />",{id:this.parent.id.loading,style:"font-family: sans-serif; font-size: 18px; font-weight: bold; color: #fff;"}),n=$hpw_("<img />",{src:this.parent.common.base_url(!1)+"/core/images/loading.gif",width:128,height:15,border:0,alt:"Loading... Please wait."}),o={position:"fixed",display:"none",width:"128px",height:"15px",top:"48%",left:"50%",marginLeft:"-"+parseInt(64,10)+"px",zIndex:parseInt(j.css("z-index"),10)+1};j.before(m);var p=$hpw_("#"+this.parent.id.loading);p.css(o).text("Loading...").append(n),p.fadeIn("medium")}else g.attr("src",i);g.bind("load",function(){return"function"==typeof e?e():void 0})},load_youtube:function(a,b){var c=this,d="http://api.hubpost.com/youtube/videos/"+a.video;c.parent.debug(a),c.parent.debug("display.load(widget_id="+a.widget_id+", channel="+a.channel+", playlist="+a.playlist+", video="+a.video+", cb="+typeof b+")"),c.parent.debug(d,"info"),$hpw_.getJSON(d,{},function(){OHUB.dim("fast",.75,function(){c.render_youtube(a.widget_id,a.channel,a.playlist,a.video,b)})})}},share:{parent:null,init:function(a){this.parent=a,this.parent.debug("share.init(parent="+typeof a+")")},render:function(a,b){this.parent.debug("share.render(args="+typeof a+", cb="+typeof b+")");var c=$hpw_("#"+this.parent.id.share),e={widget_id:a.widget_id,dom_id:this.parent.config.dom_id,widget_type:this.parent.config.type,type:this.parent.config.type,temp:this.parent.config.temp,is_theme_custom:this.parent.config.is_theme_custom,is_overriden:this.parent.config.is_overriden,old_widget_id:this.parent.config.old_widget_id,old_type:this.parent.config.old_type,old_layout:this.parent.config.old_layout,old_width:this.parent.config.old_width,old_height:this.parent.config.old_height,old_theme_id:this.parent.config.old_theme_id,is_dev:this.parent.common.config.is_dev,ref:this.parent.ref_domain},f=this.parent.config.base_url+"/display-share.html?"+$hpw_.param(e)+"#"+encodeURIComponent(document.location.href);if(0===c.length){var g=$hpw_("#"+this.parent.id.dimmer),h=$hpw_("<iframe />",{id:this.parent.id.share,src:f,allowtransparency:"true","class":"auto-height",scrolling:"no",frameborder:"no"}),i={position:"fixed",width:this.parent.config.display_width+"px",height:"100%",width:"920px",top:"0px",left:"0px",right:"0px",margin:"0 auto",minHeight:"500px",borderRadius:"11px",zIndex:OHUB.get_nhz()};$hpw_("body").prepend(h);var c=$hpw_("#"+this.parent.id.share);c.css(i);var j=$hpw_("<div />",{id:this.parent.id.loading,style:"font-family: sans-serif; font-size: 18px; font-weight: bold; color: #fff;"}),k=$hpw_("<img />",{src:this.parent.common.base_url(!1)+"/core/images/loading.gif",width:128,height:15,border:0,alt:"Loading... Please wait."}),l={position:"fixed",display:"none",width:"128px",height:"15px",top:"48%",left:"50%",marginLeft:"-"+parseInt(64,10)+"px",zIndex:parseInt(g.css("z-index"),10)+1};g.before(j);var m=$hpw_("#"+this.parent.id.loading);m.css(l).text("Loading...").append(k),m.fadeIn("medium")}else c.attr("src",f);c.bind("load",function(){return"function"==typeof b?b():void 0})},show:function(a,b){this.parent.debug("share.show(args="+typeof a+", cb="+typeof b+")");var c=this;OHUB.add_dimmer(),OHUB.dim("fast",.75,function(){c.render(a,function(){var a=["#"+c.parent.id.share,"#"+c.parent.id.close,"#"+c.parent.id.loading];return $hpw_(a.join(", ")).show(),"function"==typeof b?b():void 0})})},build:function(){this.parent.debug("share.build()")},hide:function(a){this.parent.debug("share.hide(cb="+typeof a+")");var b=["#"+this.parent.id.share,"#"+this.parent.id.close,"#"+this.parent.id.loading];return $hpw_(b.join(", ")).hide(),"function"==typeof a?a():void 0}},debug:function(a,b,c){var d="CMG.widget["+this.config.widget_id+"].main";this.common.debug(a,b,d,c)}}};