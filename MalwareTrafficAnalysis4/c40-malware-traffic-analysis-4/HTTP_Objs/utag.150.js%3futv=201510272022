//~~tv:13064.20141231
//~~tc: Update to fix mapping logic

var monetateT = new Date().getTime();

//tealium universal tag - utag.sender.13064 ut4.0.201504091716, Copyright 2015 Tealium.com Inc. All Rights Reserved.
try{
(function(id,loader,u){
  try{u=utag.o[loader].sender[id]={}}catch(e){u=utag.sender[id]};
  u.ev={'view':1};
  u.data = {};
  u.data.account="a-74ce1fd2";
  u.data.domain="sportsmansguide.com";
  u.data.number=873205;
  u.map={"event_type":"event_type"};
  u.extend=[function(a,b){ try{ if((parseFloat(b['ProductQtys'])>parseFloat(0)&&b['dom.url'].toString().indexOf('/checkout/payment')<0&&b['dom.url'].toString().indexOf('/checkout/review')<0&&b['dom.url'].toString().indexOf('/checkout/confirmation')<0)){b['EVENTscAdd']='true';b['event_type']='viewCart'} } catch(e){ utag.DB(e) }  },
function(a,b){ try{ if((b['dom.url'].toString().toLowerCase().indexOf('checkout/confirmation'.toLowerCase())>-1&&typeof b['_cprodname']!='undefined'&&b['_cprodname']!='')){b['EVENTpurchase']='true';b['event_type']='purchase'} } catch(e){ utag.DB(e) }  }];

  u.send=function(a,b,c,d,e,f){
    if(u.ev[a]||typeof u.ev.all!="undefined"){
      window.monetateQ = window.monetateQ || [];
      for(c=0;c<u.extend.length;c++){try{d=u.extend[c](a,b);if(d==false)return}catch(e){}};
      c = [];
      for(d in utag.loader.GV(u.map)){if(typeof b[d]!=="undefined"&&b[d]!==""){e=u.map[d].split(",");for(f=0;f<e.length;f++){
        u.data[e[f]] = b[d];
      }}}

      if (u.data.event_type && (u.data.event_type == 'viewCart' || u.data.event_type == 'purchase')) {

        u.data.order_id = u.data.order_id || b._corder || "";
        u.data.sku = u.data.sku || (typeof b._csku != "undefined" ? b._csku.slice(0) : []);
        u.data.prod = u.data.prod || (typeof b._cprod != "undefined" ? b._cprod.slice(0) : []);
        for (var i=0; i<u.data.prod.length; i++) {
          u.data.prod[i] = u.data.prod[i].replace(/^[^!-~]+$/, "");
        }
        u.data.price = u.data.price || (typeof b._cprice != "undefined" ? b._cprice.slice(0) : []);
        u.data.quan = u.data.quan || (typeof b._cquan != "undefined" ? b._cquan.slice(0) : []);
        u.data.event_data = [];
        
        if (u.data.event_type == "viewProductThumbnail") {
/*          u.data.page_type = u.data.page_type || "index";
          u.data.event_data = u.data.prod; 
        } else if (u.data.event_type == "viewProductDetail") {
          u.data.page_type = u.data.page_type || "product";
          u.data.event_data = u.data.prod;
*/
        } else if (u.data.event_type == "viewCart") {
//          u.data.page_type = u.data.page_type || "cart";
          u.data.call_type = "addCartRows";
          for (var i=0; i<u.data.prod.length; i++) {
            u.data.event_data.push({
              "productId": u.data.prod[i],
              "quantity": u.data.quan[i] || "1",
              "unitPrice": u.data.price[i] || "0.00",
              "sku": u.data.sku[i] || u.data.prod[i]
            });
          }


        } else if (u.data.event_type == "purchase") {
//          u.data.page_type = u.data.page_type || "purchase";
          u.data.call_type = "addPurchaseRows";
          for (var i=0; i<u.data.prod.length; i++) {
            u.data.event_data.push({
              "purchaseId": u.data.order_id,
              "productId": u.data.prod[i],
              "quantity": u.data.quan[i] || "1",
              "unitPrice": u.data.price[i] || "0.00",
              "sku": u.data.sku[i] || u.data.prod[i]
            });
          }
        }

        //custom call for 
        window.monetateQ.push([u.data.call_type,u.data.event_data]);
	window.monetateQ.push(["trackData"]);
	//clear out events
	u.data.call_type=u.data.event_data="";
/*
        window.monetateQ.push(["viewPage", u.data.page_type]);
        if (u.data.event_type != "viewPage") {
          window.monetateQ.push([u.data.event_type, u.data.event_data]);
        }

        if (u.data.report_handler) {
          window.monetateQ.push(["report", u.data.report_handler]);
        }
        */
      }
    }
  }
  try{utag.o[loader].loader.LOAD(id)}catch(e){utag.loader.LOAD(id)}
})('150','sportsman.newmain');
}catch(e){}
//end tealium universal tag

