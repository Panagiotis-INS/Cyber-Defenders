# Author:Panagiotis Fiskils/Neuro

## Challenge name:Cyber Defenders:Malware Traffic Analysis 4

### Description: ###

```
Tom and Jake are recent hires at your organization's Security Operations Center (SOC).  Due to their different personalities, they've earned the nickname "Goofus and Gallant" after a cartoon from the magazine Highlights for Children.  Tom is Goofus.  Jake is Gallant.
```

![](./Images/2015-11-24-traffic-analysis-exercise-image-01.jpg)

```
On the Tuesday before Thanksgiving, Tom and Jake are working at the SOC.  Tom brought his Windows laptop to the office, and he plans to browse the web.  Jake is hard at work reviewing alerts.
```

![](./Images/2015-11-24-traffic-analysis-exercise-image-02.jpg)

```
Jake's holiday plans are set, and he's happy with the frozen turkey he'd purchased from the supermarket.  Tom's more of a "turkey enthusiast."  He wants to hunt and kill a turkey for his Thanksgiving meal.

To pursue his holiday plans, Tom decides to purchase a shotgun.  He fires up his Windows laptop, connects to the SOC's wifi, and starts researching shotguns online.

It's not long before Tom's computer triggers some alerts for suspicious network activity.  After those alerts, his laptop crashes!
```

![](./Images/2015-11-24-traffic-analysis-exercise-image-03.jpg)

```
You're the supervisor for both Goofus and Gallant. The Goofus Tom will likely be fired at some point due to his poor work ethic.  Jake is certainly gallant, but he's still a relatively inexperienced analyst. You'll have to figure out what happened to Tom's laptop.

You check Tom's machine and quickly find a suspicious registry entry.  It looks like Goofus infected his laptop.  The SHA256 hash for the file referenced in the registry is: d16ad130daed5d4f3a7368ce73b87a8f84404873cbfc90cc77e967a83c947cd2
```

![](./Images/2015-11-24-traffic-analysis-exercise-image-04.jpg)

```
Next, you review the network alerts.  Unfortunately, your organization is too cheap for any commercial intrusion detection system (IDS).  Fortunately, lower-cost solutions have been implemented.  You have access to Snort alerts using the Snort registered ruleset.  You also have access to Suricata alerts using the EmergingThreats free ruleset.
```

![](./Images/2015-11-24-traffic-analysis-exercise-image-05.jpg)

![](./Images/2015-11-24-traffic-analysis-exercise-image-06.jpg)

# Flags: #


- Flag1: `10.1.25.119`

From the Description we know that we have a Windows victim.

We open the given pcap file using <code>Network Miner</code>

![](./Images/Flag1.png)

- Flag2: `Turkey-Tom`

From the previous flag we know the IP of the victim machine, with <code>Network Miner</code> we can find the Hostname:

![](./Images/Flag2.png)

- Flag3:`Angler`

At first I tried using the pcap file and then I got bored and started scripting:

```bash
cat malware-traffic-analysis-4-suricata-events.txt |grep -B 4 -A 6 "10.1.25.119" |grep -i -A 5 -B 6 "cnc\|Trojan\|suricata" |less
```

After searching for the coresponding TROJAN: `Trojan.Bedep` I found that the exploit kit is `Angler`

```
https://blog.malwarebytes.com/detections/trojan-bedep/
https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/bedep-trojan-malware-spread-by-the-angler-exploit-kit-gets-political/
```

![](./Images/Flag3.png)

- Flag4:`162.216.4.20`

Found this article about `Angler`:

```
https://www.forcepoint.com/blog/x-labs/popular-site-leads-angler-ek-cve-2015-8651-flash-player-exploit
```

We have to find all the systems that sent the host a swf file.

After searching for the attacking host

I found a possible IOC from snort that gave me the flag

- Flag5:`x-flash-version`

From common knowledge and some googling.

- Flag6: `http://solution.babyboomershopping.org/respondents/header.js`
We find a server that sends a network Trojan. This machine possbly has the link/URL to the real malicious server.

![](./Images/POC-Redirect.png)

Inside the iframe we find the src webiste

- Flag7:`CAPEC-222`

From Wireshark we find the following packet:

![](./Images/POC-Iframe-Referer.png)

So I searched:

```
CAPEC ID iframe
```

And the first result was the flag.

- Flag8:`shotgunworld.com`

From the previous flag we can see that the site is not malicious but compromised

![](./Images/Flag8.png)

- Flag9:`OX_7f561e63`

We follow the `213` TCP stream on Wireshark and find an obfuscated js file.

In the file we can see the payload from previous questions beeing Created:

![](./Images/Flag9-A.png)

![](./Images/Flag9-B.png)

- Flag10:`2007-08-01 18:16:48`

I managed to find the sample already uploaded in virus total and got the flag.

![](./Images/Flag10.png)

